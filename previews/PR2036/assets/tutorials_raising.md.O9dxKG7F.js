import{_ as i,c as a,o as e,al as n}from"./chunks/framework.9Yr7n4Bd.js";const o=JSON.parse('{"title":"Raising","description":"","frontmatter":{},"headers":[],"relativePath":"tutorials/raising.md","filePath":"tutorials/raising.md","lastUpdated":null}'),t={name:"tutorials/raising.md"};function l(h,s,k,p,r,d){return e(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="Raising" tabindex="-1">Raising <a class="header-anchor" href="#Raising" aria-label="Permalink to &quot;Raising {#Raising}&quot;">​</a></h1><h2 id="Raising-GPU-Kernels" tabindex="-1">Raising GPU Kernels <a class="header-anchor" href="#Raising-GPU-Kernels" aria-label="Permalink to &quot;Raising GPU Kernels {#Raising-GPU-Kernels}&quot;">​</a></h2><p>Kernel raising refer to Reactant&#39;s ability to transform a program written in a GPU kernel style. That is, kernel functions which are evaluated in a grid of blocks and threads where operations are done at the scalar level. The transformation raises the program to a tensor style function (in the StableHLO dialect) where operations are broadcasted.</p><p>This transformation enables several features:</p><ul><li><p>Running the raised compute kernel on hardware where the original kernel was not designed to run on (<em>i.e.</em> running a CUDA kernel on a TPU).</p></li><li><p>Enabling further optimizations, since the raised kernel is now indiscernible from the rest of the program, it can be optimized with it. For example, two sequential kernel launches operating on the result of each others can be fused if they are both raised. Resulting in a single kernel launch, in the final optimized StableHLO program.</p></li><li><p>Lastly, automatic-differentiation in Reactant is currently not supported for GPU kernels. Raising kernels enables Enzyme to differentiate the raised kernel. For this to function, one must use the <code>raise_first</code> compilation option to make sure the kernel are raised before Enzyme performs automatic-differentiation on the program.</p></li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Not all classes of kernels are currently raisable to StableHLO. If your kernel encounters an error while being raised, please open an issue on <a href="https://github.com/EnzymeAD/Reactant.jl/issues/new?labels=raising" target="_blank" rel="noreferrer">the Reactant.jl repository</a>.</p></div><h3 id="Example" tabindex="-1">Example <a class="header-anchor" href="#Example" aria-label="Permalink to &quot;Example {#Example}&quot;">​</a></h3><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Reactant</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> KernelAbstractions</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CUDA </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># needs to be loaded for raising even if CUDA is not functional on your system</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">Tip</p><p>We could have also directly implemented the kernel using CUDA.jl instead of KernelAbstractions.jl.</p></div><p>We will implement a simple kernel to compute the square of a vector.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">@kernel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> square_kernel!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(y, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">@Const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> @index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Global)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    @inbounds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> y[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x[i]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> square</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> similar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    backend </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> KernelAbstractions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">get_backend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kernel! </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> square_kernel!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(backend)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    kernel!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(y, x; ndrange</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> y</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">square (generic function with 1 method)</span></span></code></pre></div><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Reactant</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">to_rarray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">collect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">./</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Let&#39;s see what the HLO IR looks like for this function. Note that raising is automatically enabled for backends like TPU, where the original kernel was not designed to run on. To enable raising on other backends, pass the <code>raise=true</code> option.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">@code_hlo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> raise</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> square</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">module @reactant_square attributes {mhlo.num_partitions = 1 : i64, mhlo.num_replicas = 1 : i64} {</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">  llvm.module_flags [#llvm.mlir.module_flag&lt;warning, &quot;Dwarf Version&quot;, 2 : i32&gt;, #llvm.mlir.module_flag&lt;warning, &quot;Debug Info Version&quot;, 3 : i32&gt;]</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">  func.func @main(%arg0: tensor&lt;64xf64&gt; {enzymexla.memory_effects = []}) -&gt; tensor&lt;64xf64&gt; attributes {enzymexla.memory_effects = []} {</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %0 = stablehlo.multiply %arg0, %arg0 : tensor&lt;64xf64&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    return %0 : tensor&lt;64xf64&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">}</span></span></code></pre></div><h2 id="Raising-Scalar-Loops-to-Tensor-IR" tabindex="-1">Raising Scalar Loops to Tensor IR <a class="header-anchor" href="#Raising-Scalar-Loops-to-Tensor-IR" aria-label="Permalink to &quot;Raising Scalar Loops to Tensor IR {#Raising-Scalar-Loops-to-Tensor-IR}&quot;">​</a></h2><p>We will implement a simple N body simulation code in Reactant. Instead of using broadcasting or high-level abstractions, we will use loops and scalar operations to implement this.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Reactant, PrettyChairmarks</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Reactant</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">allowscalar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># generally not recommended to turn on globally</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#dbab09;--shiki-light-font-weight:bold;--shiki-dark:#ffea7f;--shiki-dark-font-weight:bold;">┌ </span><span style="--shiki-light:#dbab09;--shiki-light-font-weight:bold;--shiki-dark:#ffea7f;--shiki-dark-font-weight:bold;">Warning: </span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">It&#39;s not recommended to use allowscalar([true]) to allow scalar indexing.</span></span>
<span class="line"><span style="--shiki-light:#dbab09;--shiki-light-font-weight:bold;--shiki-dark:#ffea7f;--shiki-dark-font-weight:bold;">│ </span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">Instead, use \`allowscalar() do end\` or \`@allowscalar\` to denote exactly which operations can use scalar operations.</span></span>
<span class="line"><span style="--shiki-light:#dbab09;--shiki-light-font-weight:bold;--shiki-dark:#ffea7f;--shiki-dark-font-weight:bold;">└ </span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">@ GPUArraysCore ~/.julia/packages/GPUArraysCore/aNaXo/src/GPUArraysCore.jl:184</span></span></code></pre></div><p>We will implement a naive function to compute the attractive force between each pair of particles in a system.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> compute_attractive_force</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    positions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractMatrix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, masses</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, G</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Number</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    N </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(positions, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    F </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> similar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(positions, N, N)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    @trace</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">N</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        @trace</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> j </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">N</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            dx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> positions[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> positions[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, j]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            dy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> positions[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> positions[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, j]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            dz </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> positions[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> positions[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, j]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            invr² </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ifelse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> j, dx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">inv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dz</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Fx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> G </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> masses[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> masses[j] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> invr² </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dx</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Fy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> G </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> masses[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> masses[j] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> invr² </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dy</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Fz </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> G </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> masses[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> masses[j] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> invr² </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dz</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            F[i, j] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Fx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Fy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Fz</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> F</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">compute_attractive_force (generic function with 1 method)</span></span></code></pre></div><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">positions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> randn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Float32, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">masses </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Float32, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">positions_ra </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Reactant</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">to_rarray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(positions)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">masses_ra </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Reactant</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">to_rarray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(masses)</span></span></code></pre></div><p>Let&#39;s see what the HLO IR looks like for this function (without enabling the loop raising).</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">@code_hlo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> compile_options </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CompileOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    disable_loop_raising_passes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">compute_attractive_force</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(positions_ra, masses_ra, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.0f0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">module @reactant_compute... attributes {mhlo.num_partitions = 1 : i64, mhlo.num_replicas = 1 : i64} {</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">  func.func @main(%arg0: tensor&lt;1024x3xf32&gt; {enzymexla.memory_effects = []}, %arg1: tensor&lt;1024xf32&gt; {enzymexla.memory_effects = []}) -&gt; tensor&lt;1024x1024xf32&gt; attributes {enzymexla.memory_effects = []} {</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %cst = stablehlo.constant dense&lt;1.000000e+00&gt; : tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %c = stablehlo.constant dense&lt;2&gt; : tensor&lt;i32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %c_0 = stablehlo.constant dense&lt;0&gt; : tensor&lt;i32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %c_1 = stablehlo.constant dense&lt;1024&gt; : tensor&lt;i64&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %cst_2 = stablehlo.constant dense&lt;2.000000e+00&gt; : tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %cst_3 = stablehlo.constant dense&lt;0.000000e+00&gt; : tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %c_4 = stablehlo.constant dense&lt;1&gt; : tensor&lt;i32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %c_5 = stablehlo.constant dense&lt;0&gt; : tensor&lt;i64&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %c_6 = stablehlo.constant dense&lt;1&gt; : tensor&lt;i64&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %0 = stablehlo.transpose %arg0, dims = [1, 0] : (tensor&lt;1024x3xf32&gt;) -&gt; tensor&lt;3x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %1 = stablehlo.reshape %arg1 : (tensor&lt;1024xf32&gt;) -&gt; tensor&lt;1024x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %2:2 = stablehlo.while(%iterArg = %c_5, %iterArg_7 = %cst_3) : tensor&lt;i64&gt;, tensor&lt;1024x1024xf32&gt; attributes {enzyme.disable_mincut, enzymexla.symmetric_matrix = [#enzymexla&lt;guaranteed UNKNOWN&gt;, #enzymexla&lt;guaranteed UNKNOWN&gt;, #enzymexla&lt;guaranteed UNKNOWN&gt;, #enzymexla&lt;guaranteed UNKNOWN&gt;, #enzymexla&lt;guaranteed UNKNOWN&gt;, #enzymexla&lt;guaranteed UNKNOWN&gt;, #enzymexla&lt;guaranteed NOTGUARANTEED&gt;, #enzymexla&lt;guaranteed UNKNOWN&gt;, #enzymexla&lt;guaranteed UNKNOWN&gt;]}</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    cond {</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">      %3 = stablehlo.compare  LT, %iterArg, %c_1 : (tensor&lt;i64&gt;, tensor&lt;i64&gt;) -&gt; tensor&lt;i1&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">      stablehlo.return %3 : tensor&lt;i1&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    } do {</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">      %3 = stablehlo.add %c_6, %iterArg {enzymexla.bounds = [[1, 1024]]} : tensor&lt;i64&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">      %4 = stablehlo.convert %3 {enzymexla.bounds = [[1, 1024]]} : (tensor&lt;i64&gt;) -&gt; tensor&lt;i32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">      %5 = stablehlo.subtract %4, %c_4 {enzymexla.bounds = [[0, 1023]]} : tensor&lt;i32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">      %6 = stablehlo.dynamic_slice %1, %5, %c_0, sizes = [1, 1] : (tensor&lt;1024x1xf32&gt;, tensor&lt;i32&gt;, tensor&lt;i32&gt;) -&gt; tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">      %7 = stablehlo.multiply %cst_2, %6 : tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">      %8 = stablehlo.dynamic_slice %0, %c, %5, sizes = [1, 1] : (tensor&lt;3x1024xf32&gt;, tensor&lt;i32&gt;, tensor&lt;i32&gt;) -&gt; tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">      %9 = stablehlo.dynamic_slice %0, %c_4, %5, sizes = [1, 1] : (tensor&lt;3x1024xf32&gt;, tensor&lt;i32&gt;, tensor&lt;i32&gt;) -&gt; tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">      %10 = stablehlo.dynamic_slice %0, %c_0, %5, sizes = [1, 1] : (tensor&lt;3x1024xf32&gt;, tensor&lt;i32&gt;, tensor&lt;i32&gt;) -&gt; tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">      %11:2 = stablehlo.while(%iterArg_8 = %c_5, %iterArg_9 = %iterArg_7) : tensor&lt;i64&gt;, tensor&lt;1024x1024xf32&gt; attributes {enzyme.disable_mincut}</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">      cond {</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %12 = stablehlo.compare  LT, %iterArg_8, %c_1 : (tensor&lt;i64&gt;, tensor&lt;i64&gt;) -&gt; tensor&lt;i1&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        stablehlo.return %12 : tensor&lt;i1&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">      } do {</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %12 = stablehlo.add %c_6, %iterArg_8 {enzymexla.bounds = [[1, 1024]]} : tensor&lt;i64&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %13 = stablehlo.convert %12 {enzymexla.bounds = [[1, 1024]]} : (tensor&lt;i64&gt;) -&gt; tensor&lt;i32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %14 = stablehlo.subtract %13, %c_4 {enzymexla.bounds = [[0, 1023]]} : tensor&lt;i32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %15 = stablehlo.dynamic_slice %0, %c_0, %14, sizes = [1, 1] : (tensor&lt;3x1024xf32&gt;, tensor&lt;i32&gt;, tensor&lt;i32&gt;) -&gt; tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %16 = stablehlo.dynamic_slice %0, %c_4, %14, sizes = [1, 1] : (tensor&lt;3x1024xf32&gt;, tensor&lt;i32&gt;, tensor&lt;i32&gt;) -&gt; tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %17 = stablehlo.dynamic_slice %0, %c, %14, sizes = [1, 1] : (tensor&lt;3x1024xf32&gt;, tensor&lt;i32&gt;, tensor&lt;i32&gt;) -&gt; tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %18 = stablehlo.dynamic_slice %1, %14, %c_0, sizes = [1, 1] : (tensor&lt;1024x1xf32&gt;, tensor&lt;i32&gt;, tensor&lt;i32&gt;) -&gt; tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %19 = stablehlo.multiply %7, %18 : tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %20 = stablehlo.compare  EQ, %3, %12 : (tensor&lt;i64&gt;, tensor&lt;i64&gt;) -&gt; tensor&lt;i1&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %21 = stablehlo.reshape %20 : (tensor&lt;i1&gt;) -&gt; tensor&lt;1x1xi1&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %22 = stablehlo.subtract %10, %15 : tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %23 = stablehlo.multiply %22, %22 : tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %24 = stablehlo.subtract %9, %16 : tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %25 = stablehlo.multiply %24, %24 : tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %26 = stablehlo.add %23, %25 : tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %27 = stablehlo.subtract %8, %17 : tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %28 = stablehlo.multiply %27, %27 : tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %29 = stablehlo.add %26, %28 : tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %30 = stablehlo.divide %cst, %29 : tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %31 = stablehlo.select %21, %22, %30 : tensor&lt;1x1xi1&gt;, tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %32 = stablehlo.multiply %19, %31 : tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %33 = stablehlo.add %22, %24 : tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %34 = stablehlo.add %33, %27 : tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %35 = stablehlo.multiply %32, %34 : tensor&lt;1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        %36 = stablehlo.dynamic_update_slice %iterArg_9, %35, %14, %5 : (tensor&lt;1024x1024xf32&gt;, tensor&lt;1x1xf32&gt;, tensor&lt;i32&gt;, tensor&lt;i32&gt;) -&gt; tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        stablehlo.return %12, %36 : tensor&lt;i64&gt;, tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">      stablehlo.return %3, %11#1 : tensor&lt;i64&gt;, tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    return %2#1 : tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">}</span></span></code></pre></div><p>This IR has a nested loop, but that won&#39;t work nicely for GPUs/TPUs. Even for CPUs, XLA often doens&#39;t do a great job with loops. We will attempt to raise loops to a tensor IR.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">hlo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> @code_hlo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> compile_options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CompileOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    disable_loop_raising_passes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">compute_attractive_force</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(positions_ra, masses_ra, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.0f0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">hlo</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">module @reactant_compute... attributes {mhlo.num_partitions = 1 : i64, mhlo.num_replicas = 1 : i64} {</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">  func.func @main(%arg0: tensor&lt;1024x3xf32&gt; {enzymexla.memory_effects = []}, %arg1: tensor&lt;1024xf32&gt; {enzymexla.memory_effects = []}) -&gt; tensor&lt;1024x1024xf32&gt; attributes {enzymexla.memory_effects = []} {</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %cst = stablehlo.constant dense&lt;1.000000e+00&gt; : tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %cst_0 = stablehlo.constant dense&lt;2.000000e+00&gt; : tensor&lt;1024x1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %c = stablehlo.constant dense&lt;1&gt; : tensor&lt;1024x1x1xi64&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %c_1 = stablehlo.constant dense&lt;1&gt; : tensor&lt;1024xi64&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %0 = stablehlo.iota dim = 0 : tensor&lt;1024xi64&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %1 = stablehlo.add %0, %c_1 : tensor&lt;1024xi64&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %2 = stablehlo.iota dim = 0 : tensor&lt;1024x1x1xi64&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %3 = stablehlo.add %2, %c : tensor&lt;1024x1x1xi64&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %4 = stablehlo.broadcast_in_dim %3, dims = [0, 2, 3] : (tensor&lt;1024x1x1xi64&gt;) -&gt; tensor&lt;1024x1024x1x1xi64&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %5 = stablehlo.slice %arg0 [0:1024, 0:1] : (tensor&lt;1024x3xf32&gt;) -&gt; tensor&lt;1024x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %6 = stablehlo.slice %arg0 [0:1024, 1:2] : (tensor&lt;1024x3xf32&gt;) -&gt; tensor&lt;1024x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %7 = stablehlo.slice %arg0 [0:1024, 2:3] : (tensor&lt;1024x3xf32&gt;) -&gt; tensor&lt;1024x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %8 = stablehlo.reshape %arg1 : (tensor&lt;1024xf32&gt;) -&gt; tensor&lt;1024x1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %9 = stablehlo.multiply %cst_0, %8 : tensor&lt;1024x1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %10 = stablehlo.broadcast_in_dim %7, dims = [0, 2] : (tensor&lt;1024x1xf32&gt;) -&gt; tensor&lt;1024x1024x1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %11 = stablehlo.broadcast_in_dim %7, dims = [1, 2] : (tensor&lt;1024x1xf32&gt;) -&gt; tensor&lt;1024x1024x1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %12 = stablehlo.broadcast_in_dim %6, dims = [0, 2] : (tensor&lt;1024x1xf32&gt;) -&gt; tensor&lt;1024x1024x1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %13 = stablehlo.broadcast_in_dim %6, dims = [1, 2] : (tensor&lt;1024x1xf32&gt;) -&gt; tensor&lt;1024x1024x1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %14 = stablehlo.broadcast_in_dim %5, dims = [0, 2] : (tensor&lt;1024x1xf32&gt;) -&gt; tensor&lt;1024x1024x1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %15 = stablehlo.broadcast_in_dim %5, dims = [1, 2] : (tensor&lt;1024x1xf32&gt;) -&gt; tensor&lt;1024x1024x1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %16 = stablehlo.broadcast_in_dim %9, dims = [1, 2, 3] : (tensor&lt;1024x1x1xf32&gt;) -&gt; tensor&lt;1024x1024x1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %17 = stablehlo.reshape %16 : (tensor&lt;1024x1024x1x1xf32&gt;) -&gt; tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %18 = stablehlo.broadcast_in_dim %arg1, dims = [0] : (tensor&lt;1024xf32&gt;) -&gt; tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %19 = stablehlo.multiply %17, %18 : tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %20 = stablehlo.broadcast_in_dim %1, dims = [1] : (tensor&lt;1024xi64&gt;) -&gt; tensor&lt;1024x1024xi64&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %21 = stablehlo.reshape %4 : (tensor&lt;1024x1024x1x1xi64&gt;) -&gt; tensor&lt;1024x1024xi64&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %22 = stablehlo.compare  EQ, %20, %21 : (tensor&lt;1024x1024xi64&gt;, tensor&lt;1024x1024xi64&gt;) -&gt; tensor&lt;1024x1024xi1&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %23 = stablehlo.subtract %15, %14 : tensor&lt;1024x1024x1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %24 = stablehlo.reshape %23 : (tensor&lt;1024x1024x1x1xf32&gt;) -&gt; tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %25 = stablehlo.multiply %24, %24 : tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %26 = stablehlo.subtract %13, %12 : tensor&lt;1024x1024x1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %27 = stablehlo.reshape %26 : (tensor&lt;1024x1024x1x1xf32&gt;) -&gt; tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %28 = stablehlo.multiply %27, %27 : tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %29 = stablehlo.add %25, %28 : tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %30 = stablehlo.subtract %11, %10 : tensor&lt;1024x1024x1x1xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %31 = stablehlo.reshape %30 : (tensor&lt;1024x1024x1x1xf32&gt;) -&gt; tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %32 = stablehlo.multiply %31, %31 : tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %33 = stablehlo.add %29, %32 : tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %34 = stablehlo.divide %cst, %33 : tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %35 = stablehlo.select %22, %24, %34 : tensor&lt;1024x1024xi1&gt;, tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %36 = stablehlo.multiply %19, %35 : tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %37 = stablehlo.add %24, %27 : tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %38 = stablehlo.add %37, %31 : tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    %39 = stablehlo.multiply %36, %38 : tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    return %39 : tensor&lt;1024x1024xf32&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">}</span></span></code></pre></div><p>This IR won&#39;t have any loops, instead it will be written in a tensor IR! Let ensure that the values are identical.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y_jl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> compute_attractive_force</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(positions, masses, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.0f0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y_ra </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> @jit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> compile_options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CompileOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    disable_loop_raising_passes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">compute_attractive_force</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(positions_ra, masses_ra, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.0f0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">maximum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(abs, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(y_ra) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> y_jl)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">0.00048828125f0</span></span></code></pre></div><p>Let&#39;s time the execution of the two versions.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fn1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> @compile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sync</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> compile_options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CompileOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    disable_loop_raising_passes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">compute_attractive_force</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(positions_ra, masses_ra, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.0f0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fn2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> @compile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sync</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> compute_attractive_force</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(positions_ra, masses_ra, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.0f0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">Reactant compiled function compute_attractive_force (with tag ##compute_attractive_force_reactant#124088)</span></span></code></pre></div><p>Runtime for non-raised function:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">@bs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fn1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(positions_ra, masses_ra, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.0f0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">Chairmarks.Benchmark: 14 samples with 1 evaluation.</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> Range </span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">(</span><span style="--shiki-light:#1b7c83;--shiki-light-font-weight:bold;--shiki-dark:#39c5cf;--shiki-dark-font-weight:bold;">min</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> … </span><span style="--shiki-light:#5a32a3;--shiki-dark:#b392f0;">max</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">):  </span><span style="--shiki-light:#1b7c83;--shiki-light-font-weight:bold;--shiki-dark:#39c5cf;--shiki-dark-font-weight:bold;">6.701 ms</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> … </span><span style="--shiki-light:#5a32a3;--shiki-dark:#b392f0;">  8.663 ms</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">  ┊</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> GC </span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">(</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">min … max</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">): </span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">0.00% … 0.00%</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> Time  </span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">(</span><span style="--shiki-light:#0366d6;--shiki-light-font-weight:bold;--shiki-dark:#2188ff;--shiki-dark-font-weight:bold;">median</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">):     </span><span style="--shiki-light:#0366d6;--shiki-light-font-weight:bold;--shiki-dark:#2188ff;--shiki-dark-font-weight:bold;">7.176 ms               </span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">┊</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> GC </span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">(</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">median</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">):    </span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">0.00%</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> Time  </span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">(</span><span style="--shiki-light:#28a745;--shiki-light-font-weight:bold;--shiki-dark:#34d058;--shiki-dark-font-weight:bold;">mean</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> ± </span><span style="--shiki-light:#28a745;--shiki-dark:#34d058;">σ</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">):   </span><span style="--shiki-light:#28a745;--shiki-light-font-weight:bold;--shiki-dark:#34d058;--shiki-dark-font-weight:bold;">7.284 ms</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> ± </span><span style="--shiki-light:#28a745;--shiki-dark:#34d058;">474.634 μs</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">  ┊</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> GC </span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">(</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">mean ± σ</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">):  </span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">0.00% ± 0.00%</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">  ▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    ▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">  ▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> █</span><span style="--shiki-light:#0366d6;--shiki-dark:#2188ff;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">   █</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">    ▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> ▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> ▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">                               ▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">  </span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">  █</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#0366d6;--shiki-dark:#2188ff;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#28a745;--shiki-dark:#34d058;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> ▁</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">  6.7 ms</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">          Histogram: frequency by time</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        8.66 ms </span><span style="--shiki-light:#24292e;--shiki-light-font-weight:bold;--shiki-dark:#e1e4e8;--shiki-dark-font-weight:bold;">&lt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> Memory estimate</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">: </span><span style="--shiki-light:#dbab09;--shiki-dark:#ffea7f;">416.0 bytes</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">, allocs estimate</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">: </span><span style="--shiki-light:#dbab09;--shiki-dark:#ffea7f;">14</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">.</span></span></code></pre></div><p>Runtime for raised function:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">@bs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fn2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(positions_ra, masses_ra, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.0f0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">Chairmarks.Benchmark: 107 samples with 1 evaluation.</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> Range </span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">(</span><span style="--shiki-light:#1b7c83;--shiki-light-font-weight:bold;--shiki-dark:#39c5cf;--shiki-dark-font-weight:bold;">min</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> … </span><span style="--shiki-light:#5a32a3;--shiki-dark:#b392f0;">max</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">):  </span><span style="--shiki-light:#1b7c83;--shiki-light-font-weight:bold;--shiki-dark:#39c5cf;--shiki-dark-font-weight:bold;">739.305 μs</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> … </span><span style="--shiki-light:#5a32a3;--shiki-dark:#b392f0;"> 1.142 ms</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">  ┊</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> GC </span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">(</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">min … max</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">): </span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">0.00% … 0.00%</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> Time  </span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">(</span><span style="--shiki-light:#0366d6;--shiki-light-font-weight:bold;--shiki-dark:#2188ff;--shiki-dark-font-weight:bold;">median</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">):     </span><span style="--shiki-light:#0366d6;--shiki-light-font-weight:bold;--shiki-dark:#2188ff;--shiki-dark-font-weight:bold;">861.024 μs              </span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">┊</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> GC </span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">(</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">median</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">):    </span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">0.00%</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> Time  </span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">(</span><span style="--shiki-light:#28a745;--shiki-light-font-weight:bold;--shiki-dark:#34d058;--shiki-dark-font-weight:bold;">mean</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> ± </span><span style="--shiki-light:#28a745;--shiki-dark:#34d058;">σ</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">):   </span><span style="--shiki-light:#28a745;--shiki-light-font-weight:bold;--shiki-dark:#34d058;--shiki-dark-font-weight:bold;">893.162 μs</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> ± </span><span style="--shiki-light:#28a745;--shiki-dark:#34d058;">88.943 μs</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">  ┊</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> GC </span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">(</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">mean ± σ</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">):  </span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">0.00% ± 0.00%</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">         ▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">  ▆</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▆</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▃</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▆</span><span style="--shiki-light:#0366d6;--shiki-dark:#2188ff;">▃</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> ▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> ▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> ▃</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">        ▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">   ▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">                     </span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">  ▄</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▄</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▇</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#0366d6;--shiki-dark:#2188ff;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▄</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#28a745;--shiki-dark:#34d058;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▄</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▄</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▄</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▇</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▇</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▄</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▇</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▄</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">█</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▄</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▇</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▇</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▇</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▄</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▇</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▄</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▄</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▄</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▁</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">▇</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> ▄</span></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">  739 μs</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">          Histogram: frequency by time</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">         1.12 ms </span><span style="--shiki-light:#24292e;--shiki-light-font-weight:bold;--shiki-dark:#e1e4e8;--shiki-dark-font-weight:bold;">&lt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;"> Memory estimate</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">: </span><span style="--shiki-light:#dbab09;--shiki-dark:#ffea7f;">416.0 bytes</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">, allocs estimate</span><span style="--shiki-light:#959da5;--shiki-dark:#959da5;">: </span><span style="--shiki-light:#dbab09;--shiki-dark:#ffea7f;">14</span><span style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;">.</span></span></code></pre></div>`,42)])])}const y=i(t,[["render",l]]);export{o as __pageData,y as default};
